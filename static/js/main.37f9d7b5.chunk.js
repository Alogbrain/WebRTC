(this.webpackJsonpweb_rtc=this.webpackJsonpweb_rtc||[]).push([[0],{112:function(e,t){},200:function(e,t,n){},201:function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),r=n(72),c=n.n(r),i=(n(80),n(1)),o=n(2),l=n(9),u=n(4),m=n(3),d=(n(81),n(82),n(37)),p=n.n(d),h=n(8),f=n.n(h),v=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"getPermission",value:function(){return new Promise((function(e,t){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then((function(t){e(t)})).catch((function(e){throw new Error("Unable to fetch stream ",e)}))}))}}]),n}(s.a.Component),g=n(38),y=n.n(g),b=n(74),O=n(73),k=n.n(O),j=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"checkEnter",value:function(e){13===e.keyCode&&this.props.sendMessage(this.messageInput)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:""},s.a.createElement("div",{className:"bottom_wrapper"},s.a.createElement("div",{className:"message_input_wrapper"},s.a.createElement("input",{ref:function(t){e.messageInput=t},type:"text",className:"message_input",placeholder:"Type your message here",onKeyUp:this.checkEnter.bind(this)})),s.a.createElement("div",{className:"send_message",onClick:function(){return e.props.sendMessage(e.messageInput)},ref:function(t){e.inputMessage=t}},s.a.createElement("div",{className:"icon"}),s.a.createElement("div",{className:"text"},"Send"))))}}]),n}(s.a.Component),E=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){return s.a.createElement("li",{className:this.props.user?"message right":"message left"},s.a.createElement("div",{className:"avatar"},s.a.createElement("img",{id:"img",src:"https://scontent.fsgn2-1.fna.fbcdn.net/v/t1.0-9/54424813_2104573432990181_6339272824389107712_n.jpg?_nc_cat=107&_nc_sid=85a577&_nc_ohc=DmUnk1hdXe4AX_owOcC&_nc_ht=scontent.fsgn2-1.fna&oh=dd6339d06d003b67e9c8d85136fee1f3&oe=5F0BBB9E",alt:"user"})),s.a.createElement("div",{className:"text_wrapper"},s.a.createElement("div",{className:"box bg-light-info"},this.props.message)))}}]),n}(s.a.Component),_=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e=this;return s.a.createElement("ul",{className:"messages clo-md-5"},this.props.messages.map((function(t){return s.a.createElement(E,{key:t.userId,user:t.userId==e.props.user,message:t.message})})))}}]),n}(s.a.Component),U=(n(200),function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={messages:[],user:null},a}return Object(o.a)(n,[{key:"componentWillMount",value:function(){var e=this;this.props.socket.on("id",(function(t){e.setState({user:t})})),console.log("Will mount"+this.state.user),this.props.socket.on("newMessage",(function(t){e.newMessage(t)}))}},{key:"newMessage",value:function(e){var t=this.state.messages,n=k()(t,"id"),a=Math.max.apply(Math,Object(b.a)(n));t.push({id:a+1,userId:e.id,message:e.data});var s=f()(".messages");s[0].scrollHeight-s[0].scrollTop===s[0].clientHeight?(this.setState({messages:t}),s.animate({scrollTop:s.prop("scrollHeight")},300)):(this.setState({messages:t}),e.id===this.state.user&&s.animate({scrollTop:s.prop("scrollHeight")},300))}},{key:"sendnewMessage",value:function(e){e.value&&(this.props.socket.emit("newMessage",e.value),e.value="")}},{key:"render",value:function(){return this.state.user?s.a.createElement("div",{className:"app__content"},s.a.createElement("div",{className:"chat_window"},s.a.createElement(_,{user:this.state.user,messages:this.state.messages,typing:this.state.typing}),s.a.createElement(j,{sendMessage:this.sendnewMessage.bind(this)}))):null}}]),n}(s.a.Component)),w=function(e){Object(u.a)(n,e);var t=Object(m.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).state={hasMedia:!1,arrPeer:[],idPeer:null},e.mediaHandler=new v,e.socket=null,e.peer=null,e.startPeer=e.startPeer.bind(Object(l.a)(e)),e.Call=e.Call.bind(Object(l.a)(e)),e.SignUp=e.SignUp.bind(Object(l.a)(e)),e.ClickLi=e.ClickLi.bind(Object(l.a)(e)),e}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.peer=this.startPeer()}},{key:"componentWillMount",value:function(){var e=this;this.socket=y()("https://webrtc9598.herokuapp.com/"),this.mediaHandler.getPermission().then((function(t){e.setState({hasMedia:!0});try{e.myVideo.srcObject=t}catch(n){e.myVideo.src=URL.createObjectURL(t)}e.myVideo.play()})),this.socket.on("DANG_SACH_ONLINE",(function(t){t.forEach((function(t){t.ten,t.peerId;e.state.arrPeer.push(t),e.setState({arrPeer:e.state.arrPeer})})),e.socket.on("CO_NGUOI_DUNG_MOI",(function(t){t.ten,t.peerId;e.state.arrPeer.push(t),e.setState({arrPeer:e.state.arrPeer})}))})),this.socket.on("DANG_KY_THAT_BAI",(function(){return alert("username da ton tai!")})),this.socket.on("AI_DO_NGAT_KET_NOI",(function(e){f()("#"+e).remove()}))}},{key:"startPeer",value:function(){var e=this,t=new p.a;return t.on("open",(function(t){e.setState({idPeer:t}),console.log(t)})),t.on("stream",(function(t){try{e.userVideo.srcObject=t}catch(n){e.userVideo.src=URL.createObjectURL(t)}e.userVideo.play()})),t.on("call",(function(t){e.mediaHandler.getPermission().then((function(n){t.answer(n);try{e.myVideo.srcObject=n}catch(a){e.myVideo.src=URL.createObjectURL(n)}e.myVideo.play(),t.on("stream",(function(t){try{e.userVideo.srcObject=t}catch(a){e.userVideo.src=URL.createObjectURL(t)}e.userVideo.play()}))}))})),t}},{key:"Call",value:function(){var e=this,t=f()("#remoteId").val();this.mediaHandler.getPermission().then((function(n){try{e.myVideo.srcObject=n}catch(a){e.myVideo.src=URL.createObjectURL(n)}e.myVideo.play(),e.peer.call(t,n).on("stream",(function(t){try{e.userVideo.srcObject=t}catch(a){e.userVideo.src=URL.createObjectURL(t)}e.userVideo.play()}))}))}},{key:"SignUp",value:function(){var e=f()("#txtUsername").val();this.socket.emit("NGUOI_DUNG_DANG_KY",{ten:e,peerId:this.peer.id})}},{key:"ClickLi",value:function(e){var t=this;this.mediaHandler.getPermission().then((function(n){try{t.myVideo.srcObject=n}catch(a){t.myVideo.src=URL.createObjectURL(n)}t.myVideo.play(),t.peer.call(e,n).on("stream",(function(e){try{t.userVideo.srcObject=e}catch(a){t.userVideo.src=URL.createObjectURL(e)}t.userVideo.play()}))}))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"App"},s.a.createElement("p",null,"Online USer:"),s.a.createElement("ul",{id:"ulUser"}),this.state.arrPeer.map((function(t){return s.a.createElement("li",{id:t.peerId,key:t.peerId,onClick:function(){return e.ClickLi(t.peerId)}},t.ten)})),s.a.createElement("div",{className:"video-container"},s.a.createElement("h3",{id:"my-peer"},"ID : ",this.state.idPeer),s.a.createElement("video",{className:"my-video",ref:function(t){e.myVideo=t}}),s.a.createElement("video",{className:"user-video",ref:function(t){e.userVideo=t}})),s.a.createElement("div",null,s.a.createElement("input",{type:"text",id:"remoteId",placeholder:"Remote ID"}),s.a.createElement("button",{id:"btnCall",onClick:this.Call},"Call")),s.a.createElement("div",null,s.a.createElement("input",{type:"text",id:"txtUsername",placeholder:"Enter your username"}),s.a.createElement("button",{id:"btnSignUp",onClick:this.SignUp},"SignUp")),s.a.createElement(U,{socket:this.socket}))}}]),n}(s.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(w,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},75:function(e,t,n){e.exports=n(201)},80:function(e,t,n){},81:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"},82:function(e,t,n){},83:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=83}},[[75,1,2]]]);
//# sourceMappingURL=main.37f9d7b5.chunk.js.map